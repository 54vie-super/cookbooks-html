"use strict";(globalThis.webpackChunk_54vie_cookbooks=globalThis.webpackChunk_54vie_cookbooks||[]).push([[476],{8145(e,n,t){t.d(n,{R:()=>c,x:()=>a});var s=t(5410);const o={},i=s.createContext(o);function c(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),s.createElement(i.Provider,{value:n},e.children)}},9501(e,n,t){t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"api/api-client/websocket","title":"WebSocket Client","description":"Real-time WebSocket client for bidirectional communication","source":"@site/docs/api/api-client/websocket.md","sourceDirName":"api/api-client","slug":"/api/api-client/websocket","permalink":"/api/api-client/websocket","draft":false,"unlisted":false,"editUrl":"https://github.com/54vie/super-app/tree/main/cookbooks/docs/api/api-client/websocket.md","tags":[],"version":"current","frontMatter":{"title":"WebSocket Client","description":"Real-time WebSocket client for bidirectional communication","package":"@54vie/api","category":"API Client"},"sidebar":"apiSidebar","previous":{"title":"React Hooks","permalink":"/api/api-client/hooks"},"next":{"title":"Caching","permalink":"/api/api-client/cache"}}');var o=t(5178),i=t(8145);const c={title:"WebSocket Client",description:"Real-time WebSocket client for bidirectional communication",package:"@54vie/api",category:"API Client"},a="WebSocket Client",r={},l=[{value:"Installation",id:"installation",level:2},{value:"TypeScript Interfaces",id:"typescript-interfaces",level:2},{value:"Creating a WebSocket Client",id:"creating-a-websocket-client",level:2},{value:"Connection Management",id:"connection-management",level:2},{value:"Basic Connection",id:"basic-connection",level:3},{value:"With Authentication",id:"with-authentication",level:3},{value:"With Custom Protocols",id:"with-custom-protocols",level:3},{value:"Event Handling",id:"event-handling",level:2},{value:"Connection Events",id:"connection-events",level:3},{value:"Reconnection Events",id:"reconnection-events",level:3},{value:"Removing Event Listeners",id:"removing-event-listeners",level:3},{value:"Sending Messages",id:"sending-messages",level:2},{value:"Typed Messages",id:"typed-messages",level:3},{value:"Raw Messages",id:"raw-messages",level:3},{value:"Message Queue (Auto-Send on Connect)",id:"message-queue-auto-send-on-connect",level:3},{value:"Subscribing to Message Types",id:"subscribing-to-message-types",level:2},{value:"Basic Subscription",id:"basic-subscription",level:3},{value:"Multiple Subscriptions",id:"multiple-subscriptions",level:3},{value:"Wildcard Subscriptions",id:"wildcard-subscriptions",level:3},{value:"Reconnection Strategies",id:"reconnection-strategies",level:2},{value:"Exponential Backoff",id:"exponential-backoff",level:3},{value:"Custom Reconnection Logic",id:"custom-reconnection-logic",level:3},{value:"Manual Reconnection",id:"manual-reconnection",level:3},{value:"Heartbeat / Keep-Alive",id:"heartbeat--keep-alive",level:2},{value:"Custom Serialization",id:"custom-serialization",level:2},{value:"JSON Serializer (Default)",id:"json-serializer-default",level:3},{value:"MessagePack Serializer",id:"messagepack-serializer",level:3},{value:"Protocol Buffers",id:"protocol-buffers",level:3},{value:"React Hook: useWebSocket",id:"react-hook-usewebsocket",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"With Reconnection",id:"with-reconnection",level:3},{value:"Conditional Connection",id:"conditional-connection",level:3},{value:"Room/Channel Management",id:"roomchannel-management",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Related",id:"related",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"websocket-client",children:"WebSocket Client"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"@54vie/api"})," package provides a robust WebSocket client for real-time bidirectional communication with built-in support for automatic reconnection, event handling, and message serialization."]}),"\n",(0,o.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"npm install @54vie/api\n# or\nyarn add @54vie/api\n# or\npnpm add @54vie/api\n"})}),"\n",(0,o.jsx)(n.h2,{id:"typescript-interfaces",children:"TypeScript Interfaces"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"interface WebSocketConfig {\n  url: string;\n  protocols?: string | string[];\n  reconnect?: ReconnectConfig;\n  heartbeat?: HeartbeatConfig;\n  auth?: WebSocketAuthConfig;\n  serializer?: MessageSerializer;\n  debug?: boolean;\n}\n\ninterface ReconnectConfig {\n  enabled?: boolean;\n  maxAttempts?: number;\n  delay?: number;\n  maxDelay?: number;\n  backoffMultiplier?: number;\n  onReconnect?: (attempt: number) => void;\n  onReconnectFailed?: () => void;\n}\n\ninterface HeartbeatConfig {\n  enabled?: boolean;\n  interval?: number;\n  timeout?: number;\n  message?: string | object;\n}\n\ninterface WebSocketAuthConfig {\n  token?: string | (() => string | Promise<string>);\n  query?: Record<string, string>;\n  headers?: Record<string, string>;\n}\n\ninterface MessageSerializer {\n  encode: (data: unknown) => string | ArrayBuffer;\n  decode: (data: string | ArrayBuffer) => unknown;\n}\n\ninterface WebSocketMessage<T = unknown> {\n  type: string;\n  payload: T;\n  timestamp?: number;\n  id?: string;\n}\n\ninterface WebSocketEventMap {\n  open: Event;\n  close: CloseEvent;\n  error: Event;\n  message: MessageEvent;\n  reconnecting: CustomEvent<{ attempt: number }>;\n  reconnected: CustomEvent<{ attempt: number }>;\n  reconnect_failed: CustomEvent;\n}\n\ntype ConnectionState = 'connecting' | 'connected' | 'disconnected' | 'reconnecting';\n\ninterface WebSocketClient {\n  // Connection\n  connect(): Promise<void>;\n  disconnect(code?: number, reason?: string): void;\n  reconnect(): Promise<void>;\n\n  // State\n  getState(): ConnectionState;\n  isConnected(): boolean;\n\n  // Messaging\n  send<T>(type: string, payload: T): void;\n  sendRaw(data: string | ArrayBuffer): void;\n\n  // Events\n  on<K extends keyof WebSocketEventMap>(\n    event: K,\n    handler: (event: WebSocketEventMap[K]) => void\n  ): () => void;\n  off<K extends keyof WebSocketEventMap>(\n    event: K,\n    handler: (event: WebSocketEventMap[K]) => void\n  ): void;\n  once<K extends keyof WebSocketEventMap>(\n    event: K,\n    handler: (event: WebSocketEventMap[K]) => void\n  ): void;\n\n  // Message handlers\n  subscribe<T>(type: string, handler: (payload: T) => void): () => void;\n  unsubscribe(type: string, handler?: (payload: unknown) => void): void;\n\n  // Utilities\n  getSocket(): WebSocket | null;\n  getReconnectAttempts(): number;\n}\n\ninterface UseWebSocketOptions {\n  url: string;\n  protocols?: string | string[];\n  reconnect?: boolean;\n  reconnectAttempts?: number;\n  reconnectInterval?: number;\n  onOpen?: (event: Event) => void;\n  onClose?: (event: CloseEvent) => void;\n  onError?: (event: Event) => void;\n  onMessage?: (event: MessageEvent) => void;\n  shouldConnect?: boolean;\n}\n\ninterface UseWebSocketReturn {\n  sendMessage: (message: string | object) => void;\n  lastMessage: MessageEvent | null;\n  readyState: number;\n  isConnected: boolean;\n  connect: () => void;\n  disconnect: () => void;\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"creating-a-websocket-client",children:"Creating a WebSocket Client"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { WebSocketClient } from '@54vie/api';\n\nconst ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  reconnect: {\n    enabled: true,\n    maxAttempts: 5,\n    delay: 1000,\n    maxDelay: 30000,\n    backoffMultiplier: 2,\n  },\n  heartbeat: {\n    enabled: true,\n    interval: 30000,\n    timeout: 5000,\n  },\n});\n\n// Connect to the server\nawait ws.connect();\n"})}),"\n",(0,o.jsx)(n.h2,{id:"connection-management",children:"Connection Management"}),"\n",(0,o.jsx)(n.h3,{id:"basic-connection",children:"Basic Connection"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n});\n\n// Connect\nawait ws.connect();\n\n// Check connection state\nconsole.log(ws.getState()); // 'connected'\nconsole.log(ws.isConnected()); // true\n\n// Disconnect\nws.disconnect(1000, 'User initiated disconnect');\n"})}),"\n",(0,o.jsx)(n.h3,{id:"with-authentication",children:"With Authentication"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  auth: {\n    // Token can be string or function\n    token: () => localStorage.getItem('accessToken') || '',\n    // Query parameters added to URL\n    query: {\n      clientId: 'app-123',\n      version: '1.0.0',\n    },\n  },\n});\n\nawait ws.connect();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"with-custom-protocols",children:"With Custom Protocols"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  protocols: ['v1.json', 'v2.json'],\n});\n\nawait ws.connect();\n"})}),"\n",(0,o.jsx)(n.h2,{id:"event-handling",children:"Event Handling"}),"\n",(0,o.jsx)(n.h3,{id:"connection-events",children:"Connection Events"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n});\n\n// Listen for connection open\nws.on('open', (event) => {\n  console.log('Connected to WebSocket server');\n});\n\n// Listen for connection close\nws.on('close', (event) => {\n  console.log(`Connection closed: ${event.code} - ${event.reason}`);\n});\n\n// Listen for errors\nws.on('error', (event) => {\n  console.error('WebSocket error:', event);\n});\n\n// Listen for all messages\nws.on('message', (event) => {\n  console.log('Received:', event.data);\n});\n\nawait ws.connect();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"reconnection-events",children:"Reconnection Events"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  reconnect: {\n    enabled: true,\n    maxAttempts: 5,\n  },\n});\n\n// Listen for reconnection attempts\nws.on('reconnecting', (event) => {\n  console.log(`Reconnecting... Attempt ${event.detail.attempt}`);\n});\n\n// Listen for successful reconnection\nws.on('reconnected', (event) => {\n  console.log(`Reconnected after ${event.detail.attempt} attempts`);\n});\n\n// Listen for reconnection failure\nws.on('reconnect_failed', () => {\n  console.error('Failed to reconnect after max attempts');\n});\n\nawait ws.connect();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"removing-event-listeners",children:"Removing Event Listeners"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Using returned unsubscribe function\nconst unsubscribe = ws.on('message', (event) => {\n  console.log('Message:', event.data);\n});\n\n// Later, remove the listener\nunsubscribe();\n\n// Or using off method\nconst handler = (event: MessageEvent) => {\n  console.log('Message:', event.data);\n};\n\nws.on('message', handler);\nws.off('message', handler);\n\n// One-time listener\nws.once('open', () => {\n  console.log('Connected (only called once)');\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"sending-messages",children:"Sending Messages"}),"\n",(0,o.jsx)(n.h3,{id:"typed-messages",children:"Typed Messages"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"interface ChatMessage {\n  roomId: string;\n  content: string;\n  senderId: string;\n}\n\n// Send a typed message\nws.send<ChatMessage>('chat:message', {\n  roomId: 'room-123',\n  content: 'Hello, world!',\n  senderId: 'user-456',\n});\n\n// Message is serialized as:\n// { type: 'chat:message', payload: { roomId: '...', content: '...', senderId: '...' } }\n"})}),"\n",(0,o.jsx)(n.h3,{id:"raw-messages",children:"Raw Messages"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Send raw string\nws.sendRaw('ping');\n\n// Send binary data\nconst buffer = new ArrayBuffer(8);\nws.sendRaw(buffer);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"message-queue-auto-send-on-connect",children:"Message Queue (Auto-Send on Connect)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { WebSocketClient } from '@54vie/api';\n\nconst ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n});\n\n// Messages are queued if sent before connection\nws.send('user:status', { status: 'online' });\n\n// They will be sent automatically when connected\nawait ws.connect();\n"})}),"\n",(0,o.jsx)(n.h2,{id:"subscribing-to-message-types",children:"Subscribing to Message Types"}),"\n",(0,o.jsx)(n.h3,{id:"basic-subscription",children:"Basic Subscription"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"interface NotificationPayload {\n  id: string;\n  title: string;\n  body: string;\n  createdAt: string;\n}\n\n// Subscribe to specific message types\nconst unsubscribe = ws.subscribe<NotificationPayload>('notification', (payload) => {\n  console.log(`New notification: ${payload.title}`);\n  showNotification(payload);\n});\n\n// Later, unsubscribe\nunsubscribe();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"multiple-subscriptions",children:"Multiple Subscriptions"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"interface UserOnline {\n  userId: string;\n  username: string;\n}\n\ninterface UserOffline {\n  userId: string;\n}\n\ninterface ChatMessage {\n  roomId: string;\n  senderId: string;\n  content: string;\n  timestamp: number;\n}\n\n// Subscribe to multiple message types\nws.subscribe<UserOnline>('user:online', (payload) => {\n  addOnlineUser(payload);\n});\n\nws.subscribe<UserOffline>('user:offline', (payload) => {\n  removeOnlineUser(payload.userId);\n});\n\nws.subscribe<ChatMessage>('chat:message', (payload) => {\n  addMessageToRoom(payload.roomId, payload);\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"wildcard-subscriptions",children:"Wildcard Subscriptions"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Subscribe to all messages with a prefix\nws.subscribe('chat:*', (payload, type) => {\n  console.log(`Chat event: ${type}`, payload);\n});\n\n// Handles: chat:message, chat:typing, chat:read, etc.\n"})}),"\n",(0,o.jsx)(n.h2,{id:"reconnection-strategies",children:"Reconnection Strategies"}),"\n",(0,o.jsx)(n.h3,{id:"exponential-backoff",children:"Exponential Backoff"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  reconnect: {\n    enabled: true,\n    maxAttempts: 10,\n    delay: 1000, // Start with 1 second\n    maxDelay: 30000, // Max 30 seconds\n    backoffMultiplier: 2, // Double each attempt\n    onReconnect: (attempt) => {\n      console.log(`Reconnect attempt ${attempt}`);\n      showReconnectingUI(attempt);\n    },\n    onReconnectFailed: () => {\n      console.error('Connection lost');\n      showConnectionLostUI();\n    },\n  },\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"custom-reconnection-logic",children:"Custom Reconnection Logic"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  reconnect: {\n    enabled: true,\n    maxAttempts: Infinity, // Never give up\n    delay: 1000,\n    maxDelay: 60000,\n    backoffMultiplier: 1.5,\n  },\n});\n\n// Custom reconnection with token refresh\nws.on('reconnecting', async () => {\n  // Refresh token before reconnecting\n  const newToken = await refreshAuthToken();\n  ws.updateAuth({ token: newToken });\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"manual-reconnection",children:"Manual Reconnection"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  reconnect: {\n    enabled: false, // Disable auto-reconnect\n  },\n});\n\nws.on('close', (event) => {\n  if (event.code !== 1000) {\n    // Abnormal closure, attempt reconnect\n    setTimeout(() => {\n      ws.reconnect();\n    }, 5000);\n  }\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"heartbeat--keep-alive",children:"Heartbeat / Keep-Alive"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  heartbeat: {\n    enabled: true,\n    interval: 30000, // Send ping every 30 seconds\n    timeout: 5000, // Wait 5 seconds for pong\n    message: { type: 'ping' }, // Custom ping message\n  },\n});\n\n// The client automatically handles heartbeat\n// If pong is not received within timeout, connection is considered dead\n"})}),"\n",(0,o.jsx)(n.h2,{id:"custom-serialization",children:"Custom Serialization"}),"\n",(0,o.jsx)(n.h3,{id:"json-serializer-default",children:"JSON Serializer (Default)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  serializer: {\n    encode: (data) => JSON.stringify(data),\n    decode: (data) => JSON.parse(data as string),\n  },\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"messagepack-serializer",children:"MessagePack Serializer"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { encode, decode } from '@msgpack/msgpack';\n\nconst ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  serializer: {\n    encode: (data) => encode(data),\n    decode: (data) => decode(data as ArrayBuffer),\n  },\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"protocol-buffers",children:"Protocol Buffers"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { MyMessage } from './proto/messages';\n\nconst ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n  serializer: {\n    encode: (data) => MyMessage.encode(data).finish(),\n    decode: (data) => MyMessage.decode(new Uint8Array(data as ArrayBuffer)),\n  },\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"react-hook-usewebsocket",children:"React Hook: useWebSocket"}),"\n",(0,o.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { useWebSocket } from '@54vie/api';\n\nfunction ChatRoom({ roomId }: { roomId: string }) {\n  const {\n    sendMessage,\n    lastMessage,\n    readyState,\n    isConnected,\n  } = useWebSocket({\n    url: `wss://api.54vie.com/ws?room=${roomId}`,\n    onMessage: (event) => {\n      const message = JSON.parse(event.data);\n      handleNewMessage(message);\n    },\n  });\n\n  const handleSend = (text: string) => {\n    sendMessage({\n      type: 'chat:message',\n      payload: { text, roomId },\n    });\n  };\n\n  return (\n    <div>\n      <ConnectionStatus connected={isConnected} />\n      <MessageList />\n      <MessageInput onSend={handleSend} disabled={!isConnected} />\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"with-reconnection",children:"With Reconnection"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"function LiveFeed() {\n  const [messages, setMessages] = useState<Message[]>([]);\n\n  const { isConnected, connect, disconnect } = useWebSocket({\n    url: 'wss://api.54vie.com/ws/feed',\n    reconnect: true,\n    reconnectAttempts: 5,\n    reconnectInterval: 3000,\n    onOpen: () => {\n      console.log('Connected to live feed');\n    },\n    onClose: () => {\n      console.log('Disconnected from live feed');\n    },\n    onMessage: (event) => {\n      const message = JSON.parse(event.data);\n      setMessages((prev) => [...prev, message]);\n    },\n  });\n\n  return (\n    <div>\n      <button onClick={isConnected ? disconnect : connect}>\n        {isConnected ? 'Disconnect' : 'Connect'}\n      </button>\n      <FeedList messages={messages} />\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"conditional-connection",children:"Conditional Connection"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"function UserPresence({ userId }: { userId: string | null }) {\n  const { isConnected } = useWebSocket({\n    url: `wss://api.54vie.com/ws/presence?userId=${userId}`,\n    // Only connect when userId is available\n    shouldConnect: !!userId,\n    onOpen: () => {\n      console.log('Presence connected');\n    },\n  });\n\n  return <PresenceIndicator connected={isConnected} />;\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"roomchannel-management",children:"Room/Channel Management"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { WebSocketClient } from '@54vie/api';\n\nconst ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n});\n\n// Join a room\nfunction joinRoom(roomId: string) {\n  ws.send('room:join', { roomId });\n}\n\n// Leave a room\nfunction leaveRoom(roomId: string) {\n  ws.send('room:leave', { roomId });\n}\n\n// Send message to room\nfunction sendRoomMessage(roomId: string, content: string) {\n  ws.send('room:message', { roomId, content });\n}\n\n// Subscribe to room events\nws.subscribe('room:joined', ({ roomId, members }) => {\n  console.log(`Joined room ${roomId} with ${members.length} members`);\n});\n\nws.subscribe('room:member_joined', ({ roomId, member }) => {\n  console.log(`${member.name} joined room ${roomId}`);\n});\n\nws.subscribe('room:member_left', ({ roomId, memberId }) => {\n  console.log(`Member ${memberId} left room ${roomId}`);\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ws = new WebSocketClient({\n  url: 'wss://api.54vie.com/ws',\n});\n\n// Handle connection errors\nws.on('error', (event) => {\n  console.error('WebSocket error:', event);\n  // Show error UI\n  showErrorNotification('Connection error occurred');\n});\n\n// Handle close with error codes\nws.on('close', (event) => {\n  switch (event.code) {\n    case 1000:\n      console.log('Normal closure');\n      break;\n    case 1001:\n      console.log('Going away');\n      break;\n    case 1006:\n      console.error('Abnormal closure (no close frame)');\n      break;\n    case 1008:\n      console.error('Policy violation');\n      break;\n    case 1011:\n      console.error('Server error');\n      break;\n    case 4001:\n      console.error('Authentication failed');\n      handleAuthError();\n      break;\n    case 4002:\n      console.error('Rate limited');\n      handleRateLimit();\n      break;\n    default:\n      console.error(`Unexpected close: ${event.code}`);\n  }\n});\n\n// Handle message errors\nws.subscribe('error', (error) => {\n  console.error('Server error:', error);\n  showErrorNotification(error.message);\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Always handle disconnection"})," - Implement proper cleanup and reconnection logic"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Use typed messages"})," - Leverage TypeScript for type-safe message handling"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Implement heartbeat"})," - Keep connections alive and detect dead connections"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Queue messages"})," - Buffer messages when disconnected for later delivery"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Handle authentication"})," - Refresh tokens before they expire"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Clean up subscriptions"})," - Unsubscribe when components unmount"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/api/api-client/client",children:"ApiClient"})," - Core HTTP client"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/api/api-client/hooks",children:"React Hooks"})," - useQuery, useMutation hooks"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/api/api-client/cache",children:"Caching"})," - Response caching and offline support"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);