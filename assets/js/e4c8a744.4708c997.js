"use strict";(globalThis.webpackChunk_54vie_cookbooks=globalThis.webpackChunk_54vie_cookbooks||[]).push([[989],{7470(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"guides/authentication","title":"Authentication","description":"Guide to implement authentication in 54VIE Super App.","source":"@site/docs/guides/authentication.md","sourceDirName":"guides","slug":"/guides/authentication","permalink":"/guides/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/54vie/super-app/tree/main/cookbooks/docs/guides/authentication.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Authentication"},"sidebar":"mainSidebar","previous":{"title":"Create a New Mini-App","permalink":"/guides/create-mini-app"},"next":{"title":"Bridge Services","permalink":"/guides/bridge-services"}}');var s=i(5178),r=i(8145);const o={sidebar_position:2,title:"Authentication"},a="Authentication Guide",c={},l=[{value:"Overview",id:"overview",level:2},{value:"In Host App",id:"in-host-app",level:2},{value:"useAuth Hook",id:"useauth-hook",level:3},{value:"SSO Login",id:"sso-login",level:3},{value:"Biometric Authentication",id:"biometric-authentication",level:3},{value:"In Mini-App",id:"in-mini-app",level:2},{value:"Checking Authentication",id:"checking-authentication",level:3},{value:"API Calls with Auth",id:"api-calls-with-auth",level:3},{value:"Token Management",id:"token-management",level:2},{value:"Token Refresh",id:"token-refresh",level:3},{value:"Token Storage",id:"token-storage",level:3},{value:"Session Management",id:"session-management",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Always check authentication",id:"1-always-check-authentication",level:3},{value:"2. Handle token expiry gracefully",id:"2-handle-token-expiry-gracefully",level:3},{value:"3. Secure token storage",id:"3-secure-token-storage",level:3}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"authentication-guide",children:"Authentication Guide"})}),"\n",(0,s.jsx)(n.p,{children:"Guide to implement authentication in 54VIE Super App."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"54VIE uses JWT-based authentication with support for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Email/Password login"}),"\n",(0,s.jsx)(n.li,{children:"SSO (Google, Apple, Facebook)"}),"\n",(0,s.jsx)(n.li,{children:"Biometric authentication"}),"\n",(0,s.jsx)(n.li,{children:"Automatic token refresh"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"in-host-app",children:"In Host App"}),"\n",(0,s.jsx)(n.h3,{id:"useauth-hook",children:"useAuth Hook"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useAuth } from '../auth';\n\nfunction ProfileScreen() {\n  const {\n    user,           // Current user object\n    isAuthenticated,// Boolean\n    isLoading,      // Loading state\n    login,          // Email login\n    register,       // Register new account\n    logout,         // Logout\n    refreshToken,   // Manual token refresh\n  } = useAuth();\n\n  if (!isAuthenticated) {\n    return <LoginScreen />;\n  }\n\n  return <UserProfile user={user} onLogout={logout} />;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"sso-login",children:"SSO Login"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { useSSO } from \'../auth\';\n\nfunction SSOButtons() {\n  const {\n    signInWithGoogle,\n    signInWithApple,\n    signInWithFacebook,\n    isLoading,\n  } = useSSO();\n\n  return (\n    <View>\n      <Button\n        icon="google"\n        onPress={signInWithGoogle}\n        loading={isLoading}\n      >\n        Continue with Google\n      </Button>\n      <Button\n        icon="apple"\n        onPress={signInWithApple}\n        loading={isLoading}\n      >\n        Continue with Apple\n      </Button>\n    </View>\n  );\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"biometric-authentication",children:"Biometric Authentication"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useBiometric } from '../auth';\n\nfunction BiometricLogin() {\n  const {\n    isSupported,\n    isEnabled,\n    biometryType,  // 'FaceID' | 'TouchID' | 'Fingerprint'\n    authenticate,\n    enable,\n    disable,\n  } = useBiometric();\n\n  const handleBiometricLogin = async () => {\n    const success = await authenticate('Login to 54VIE');\n    if (success) {\n      // Get stored credentials and login\n    }\n  };\n\n  if (!isSupported) return null;\n\n  return (\n    <Button onPress={handleBiometricLogin}>\n      Login with {biometryType}\n    </Button>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"in-mini-app",children:"In Mini-App"}),"\n",(0,s.jsx)(n.h3,{id:"checking-authentication",children:"Checking Authentication"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useHostAuth } from '@54vie/miniapp-sdk';\n\nfunction MiniAppScreen() {\n  const {\n    user,\n    isAuthenticated,\n    accessToken,\n    requestLogin,\n  } = useHostAuth();\n\n  if (!isAuthenticated) {\n    return (\n      <View>\n        <Text>Please login to continue</Text>\n        <Button onPress={requestLogin}>Login</Button>\n      </View>\n    );\n  }\n\n  return <AuthenticatedContent user={user} />;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"api-calls-with-auth",children:"API Calls with Auth"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { api, useHostAuth } from '@54vie/miniapp-sdk';\n\nfunction OrderList() {\n  const { accessToken } = useHostAuth();\n\n  // Token is automatically injected\n  const orders = await api.get('/orders');\n\n  // Or manual if needed\n  const response = await fetch('https://api.54vie.vn/orders', {\n    headers: {\n      'Authorization': `Bearer ${accessToken}`,\n    },\n  });\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"token-management",children:"Token Management"}),"\n",(0,s.jsx)(n.h3,{id:"token-refresh",children:"Token Refresh"}),"\n",(0,s.jsx)(n.p,{children:"Tokens are automatically refreshed when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Token is about to expire (5 minutes before expiry)"}),"\n",(0,s.jsx)(n.li,{children:"API returns 401"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In AuthProvider\nconst AUTH_CONFIG = {\n  tokenRefreshThreshold: 300, // 5 minutes\n  autoRefreshTokens: true,\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"token-storage",children:"Token Storage"}),"\n",(0,s.jsx)(n.p,{children:"Tokens are stored securely:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"iOS: Keychain"}),"\n",(0,s.jsx)(n.li,{children:"Android: Encrypted SharedPreferences"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// TokenManager.ts\nimport * as Keychain from 'react-native-keychain';\n\nclass TokenManager {\n  async setTokens(tokens: AuthTokens) {\n    await Keychain.setGenericPassword(\n      'tokens',\n      JSON.stringify(tokens),\n      { service: '54vie-auth' }\n    );\n  }\n\n  async getTokens(): Promise<AuthTokens | null> {\n    const result = await Keychain.getGenericPassword({ service: '54vie-auth' });\n    if (result) {\n      return JSON.parse(result.password);\n    }\n    return null;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"session-management",children:"Session Management"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// SessionManager.ts\nclass SessionManager {\n  private session: Session | null = null;\n\n  startSession(user: User) {\n    this.session = {\n      user,\n      startedAt: Date.now(),\n      lastActiveAt: Date.now(),\n    };\n  }\n\n  isAuthenticated(): boolean {\n    if (!this.session) return false;\n    return !this.isSessionExpired();\n  }\n\n  private isSessionExpired(): boolean {\n    const timeout = 30 * 60 * 1000; // 30 minutes\n    return Date.now() - this.session.lastActiveAt > timeout;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useAuth } from '../auth';\n\nfunction LoginForm() {\n  const { login, error, clearError } = useAuth();\n\n  const handleSubmit = async () => {\n    try {\n      await login({ email, password });\n    } catch (error) {\n      if (error.code === 'INVALID_CREDENTIALS') {\n        Toast.error('Invalid email or password');\n      } else if (error.code === 'ACCOUNT_LOCKED') {\n        Toast.error('Account locked. Please contact support.');\n      } else {\n        Toast.error('Login failed. Please try again.');\n      }\n    }\n  };\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-always-check-authentication",children:"1. Always check authentication"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good\nif (!isAuthenticated) {\n  return <LoginPrompt />;\n}\n\n// \u274c Bad - assuming user is logged in\nreturn <ProtectedContent />;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-handle-token-expiry-gracefully",children:"2. Handle token expiry gracefully"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good - auto refresh or prompt re-login\napiClient.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    if (error.response?.status === 401) {\n      const refreshed = await tokenManager.refreshToken();\n      if (refreshed) {\n        return apiClient.request(error.config);\n      }\n      navigation.navigate('Login');\n    }\n    throw error;\n  }\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-secure-token-storage",children:"3. Secure token storage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good - Use Keychain/EncryptedStorage\nawait Keychain.setGenericPassword('tokens', JSON.stringify(tokens));\n\n// \u274c Bad - Plain AsyncStorage\nawait AsyncStorage.setItem('tokens', JSON.stringify(tokens));\n"})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},8145(e,n,i){i.d(n,{R:()=>o,x:()=>a});var t=i(5410);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);