"use strict";(globalThis.webpackChunk_54vie_cookbooks=globalThis.webpackChunk_54vie_cookbooks||[]).push([[379],{2861(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"modules/api","title":"@54vie/api","description":"Package for managing networking, API calls, caching, and real-time connections.","source":"@site/docs/modules/api.md","sourceDirName":"modules","slug":"/modules/api","permalink":"/modules/api","draft":false,"unlisted":false,"editUrl":"https://github.com/54vie/super-app/tree/main/cookbooks/docs/modules/api.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"@54vie/api"},"sidebar":"mainSidebar","previous":{"title":"app-host","permalink":"/modules/app-host"},"next":{"title":"@54vie/analytics","permalink":"/modules/analytics"}}');var i=t(5178),s=t(8145);const r={sidebar_position:7,title:"@54vie/api"},o="@54vie/api - API Client",c={},l=[{value:"Installation",id:"installation",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"API Client",id:"api-client",level:2},{value:"Basic Requests",id:"basic-requests",level:3},{value:"Request Options",id:"request-options",level:3},{value:"File Upload",id:"file-upload",level:3},{value:"React Hooks",id:"react-hooks",level:2},{value:"useQuery",id:"usequery",level:3},{value:"useMutation",id:"usemutation",level:3},{value:"useInfiniteQuery",id:"useinfinitequery",level:3},{value:"Interceptors",id:"interceptors",level:2},{value:"Request Interceptor",id:"request-interceptor",level:3},{value:"Response Interceptor",id:"response-interceptor",level:3},{value:"Caching",id:"caching",level:2},{value:"Cache Manager",id:"cache-manager",level:3},{value:"Cache Strategies",id:"cache-strategies",level:3},{value:"WebSocket",id:"websocket",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"useWebSocket Hook",id:"usewebsocket-hook",level:3},{value:"Offline Support",id:"offline-support",level:2},{value:"Offline Queue",id:"offline-queue",level:3},{value:"Auto Sync",id:"auto-sync",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Configuration",id:"configuration",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"54vieapi---api-client",children:"@54vie/api - API Client"})}),"\n",(0,i.jsx)(n.p,{children:"Package for managing networking, API calls, caching, and real-time connections."}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm add @54vie/api\n"})}),"\n",(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import { apiClient, useQuery, useMutation } from '@54vie/api';\n\n// Simple GET request\nconst users = await apiClient.get('/users');\n\n// With React hook\nfunction UserList() {\n  const { data, isLoading, error } = useQuery({\n    key: ['users'],\n    fn: () => apiClient.get('/users'),\n  });\n\n  if (isLoading) return <Loading />;\n  return <FlatList data={data} />;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"api-client",children:"API Client"}),"\n",(0,i.jsx)(n.h3,{id:"basic-requests",children:"Basic Requests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { apiClient } from '@54vie/api';\n\n// GET\nconst users = await apiClient.get('/users');\nconst user = await apiClient.get('/users/123');\n\n// POST\nconst newUser = await apiClient.post('/users', {\n  name: 'John',\n  email: 'john@example.com',\n});\n\n// PUT\nawait apiClient.put('/users/123', { name: 'Jane' });\n\n// PATCH\nawait apiClient.patch('/users/123', { status: 'active' });\n\n// DELETE\nawait apiClient.delete('/users/123');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"request-options",children:"Request Options"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const data = await apiClient.get('/products', {\n  params: { category: 'electronics', page: 1 },\n  headers: { 'X-Custom-Header': 'value' },\n  timeout: 10000,\n  cache: true,\n  cacheTTL: 5 * 60 * 1000, // 5 minutes\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"file-upload",children:"File Upload"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const formData = new FormData();\nformData.append('file', {\n  uri: fileUri,\n  type: 'image/jpeg',\n  name: 'photo.jpg',\n});\n\nawait apiClient.upload('/upload', formData, {\n  onProgress: (progress) => {\n    console.log(`Upload: ${progress.percent}%`);\n  },\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"react-hooks",children:"React Hooks"}),"\n",(0,i.jsx)(n.h3,{id:"usequery",children:"useQuery"}),"\n",(0,i.jsx)(n.p,{children:"Fetch data with caching and refetch:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useQuery } from '@54vie/api';\n\nfunction ProductList() {\n  const {\n    data,\n    isLoading,\n    error,\n    refetch,\n    isRefetching,\n  } = useQuery({\n    key: ['products', categoryId],\n    fn: () => apiClient.get(`/products?category=${categoryId}`),\n    staleTime: 5 * 60 * 1000, // Cache 5 minutes\n    refetchOnMount: true,\n    refetchOnFocus: true,\n    onSuccess: (data) => console.log('Loaded:', data),\n    onError: (error) => console.error('Error:', error),\n  });\n\n  return (\n    <FlatList\n      data={data}\n      refreshing={isRefetching}\n      onRefresh={refetch}\n    />\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"usemutation",children:"useMutation"}),"\n",(0,i.jsx)(n.p,{children:"For operations that change data (POST, PUT, DELETE):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useMutation, invalidateQueries } from '@54vie/api';\n\nfunction CreateProduct() {\n  const { mutate, isLoading, error } = useMutation({\n    fn: (data) => apiClient.post('/products', data),\n    onSuccess: (result) => {\n      Toast.success('Product created!');\n      invalidateQueries(['products']); // Refetch product list\n    },\n    onError: (error) => {\n      Toast.error(error.message);\n    },\n  });\n\n  const handleSubmit = () => {\n    mutate({ name, price, category });\n  };\n\n  return (\n    <Button onPress={handleSubmit} loading={isLoading}>\n      Create\n    </Button>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"useinfinitequery",children:"useInfiniteQuery"}),"\n",(0,i.jsx)(n.p,{children:"For pagination/infinite scroll:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useInfiniteQuery } from '@54vie/api';\n\nfunction InfiniteList() {\n  const {\n    data,\n    fetchNextPage,\n    hasNextPage,\n    isFetchingNextPage,\n  } = useInfiniteQuery({\n    key: ['posts'],\n    fn: ({ pageParam = 1 }) =>\n      apiClient.get(`/posts?page=${pageParam}`),\n    getNextPageParam: (lastPage) => lastPage.nextPage,\n  });\n\n  // Flatten pages\n  const posts = data?.pages.flatMap(page => page.items) ?? [];\n\n  return (\n    <FlatList\n      data={posts}\n      onEndReached={() => hasNextPage && fetchNextPage()}\n      ListFooterComponent={\n        isFetchingNextPage ? <Loading /> : null\n      }\n    />\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"interceptors",children:"Interceptors"}),"\n",(0,i.jsx)(n.h3,{id:"request-interceptor",children:"Request Interceptor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { apiClient } from '@54vie/api';\n\n// Add auth token to all requests\napiClient.interceptors.request.use((config) => {\n  const token = TokenManager.getAccessToken();\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"response-interceptor",children:"Response Interceptor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Handle 401 errors globally\napiClient.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    if (error.response?.status === 401) {\n      // Try refresh token\n      const refreshed = await TokenManager.refreshToken();\n      if (refreshed) {\n        // Retry original request\n        return apiClient.request(error.config);\n      }\n      // Redirect to login\n      navigation.navigate('Login');\n    }\n    throw error;\n  }\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"caching",children:"Caching"}),"\n",(0,i.jsx)(n.h3,{id:"cache-manager",children:"Cache Manager"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { ApiCacheManager } from '@54vie/api';\n\n// Set cache\nApiCacheManager.set('user:123', userData, 5 * 60 * 1000);\n\n// Get cache\nconst cached = ApiCacheManager.get('user:123');\n\n// Invalidate\nApiCacheManager.invalidate('user:123');\nApiCacheManager.invalidateByPrefix('user:');\n\n// Clear all\nApiCacheManager.clear();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cache-strategies",children:"Cache Strategies"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import {\n  cacheFirst,\n  networkFirst,\n  staleWhileRevalidate,\n} from '@54vie/api';\n\n// Cache first - Use cache if available\nconst data = await cacheFirst('products', () =>\n  apiClient.get('/products')\n);\n\n// Network first - Always try network, fallback to cache\nconst data = await networkFirst('products', () =>\n  apiClient.get('/products')\n);\n\n// Stale while revalidate - Return cache immediately, update in background\nconst data = await staleWhileRevalidate('products', fetcher, {\n  onRevalidate: (newData) => {\n    console.log('Data updated:', newData);\n  },\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"websocket",children:"WebSocket"}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { wsClient } from '@54vie/api';\n\n// Connect\nawait wsClient.connect('wss://api.54vie.vn/ws');\n\n// Subscribe to channel\nwsClient.subscribe('chat:room-123', (message) => {\n  console.log('New message:', message);\n});\n\n// Send message\nwsClient.send('chat:room-123', { text: 'Hello!' });\n\n// Unsubscribe\nwsClient.unsubscribe('chat:room-123');\n\n// Disconnect\nwsClient.disconnect();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"usewebsocket-hook",children:"useWebSocket Hook"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useWebSocket, useChannel } from '@54vie/api';\n\nfunction ChatRoom({ roomId }) {\n  const { isConnected, send } = useWebSocket();\n\n  const { messages } = useChannel(`chat:${roomId}`, {\n    onMessage: (msg) => setMessages(prev => [...prev, msg]),\n  });\n\n  const sendMessage = (text) => {\n    send(`chat:${roomId}`, { text, userId: currentUser.id });\n  };\n\n  return (\n    <View>\n      <FlatList data={messages} />\n      <MessageInput onSend={sendMessage} />\n    </View>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"offline-support",children:"Offline Support"}),"\n",(0,i.jsx)(n.h3,{id:"offline-queue",children:"Offline Queue"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useOffline, offlineQueue } from '@54vie/api';\n\nfunction CreateOrder() {\n  const { isOnline } = useOffline();\n\n  const handleSubmit = async () => {\n    if (isOnline) {\n      await apiClient.post('/orders', orderData);\n    } else {\n      // Queue for later\n      offlineQueue.add({\n        method: 'POST',\n        url: '/orders',\n        data: orderData,\n      });\n      Toast.info('Order saved. Will sync when online.');\n    }\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"auto-sync",children:"Auto Sync"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { offlineQueue } from '@54vie/api';\n\n// Process queue when online\nofflineQueue.process();\n\n// Listen to queue changes\nofflineQueue.onStatusChange((status) => {\n  console.log(`Queue: ${status.pending} pending, ${status.failed} failed`);\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import {\n  ApiError,\n  getErrorMessage,\n  isRetryableError,\n  isAuthError,\n} from '@54vie/api';\n\ntry {\n  await apiClient.post('/orders', data);\n} catch (error) {\n  if (error instanceof ApiError) {\n    // Get localized message\n    const message = getErrorMessage(error.code);\n\n    if (isAuthError(error.code)) {\n      // Handle auth error\n      navigation.navigate('Login');\n    } else if (isRetryableError(error.code)) {\n      // Can retry\n      Toast.error(message + ' Tap to retry.');\n    } else {\n      Toast.error(message);\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { configureApi } from '@54vie/api';\n\nconfigureApi({\n  baseURL: 'https://api.54vie.vn/v1',\n  timeout: 30000,\n  headers: {\n    'X-App-Version': '1.0.0',\n    'X-Platform': Platform.OS,\n  },\n  retry: {\n    attempts: 3,\n    delay: 1000,\n    statusCodes: [408, 500, 502, 503, 504],\n  },\n  cache: {\n    enabled: true,\n    ttl: 5 * 60 * 1000,\n  },\n});\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8145(e,n,t){t.d(n,{R:()=>r,x:()=>o});var a=t(5410);const i={},s=a.createContext(i);function r(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);