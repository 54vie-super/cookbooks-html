"use strict";(globalThis.webpackChunk_54vie_cookbooks=globalThis.webpackChunk_54vie_cookbooks||[]).push([[726],{3915(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"api/analytics/experiments","title":"Experiments & Feature Flags","description":"A/B testing API, useExperiment, useFeatureFlag, and conversion tracking for @54vie/analytics","source":"@site/docs/api/analytics/experiments.md","sourceDirName":"api/analytics","slug":"/api/analytics/experiments","permalink":"/api/analytics/experiments","draft":false,"unlisted":false,"editUrl":"https://github.com/54vie/super-app/tree/main/cookbooks/docs/api/analytics/experiments.md","tags":[],"version":"current","frontMatter":{"title":"Experiments & Feature Flags","description":"A/B testing API, useExperiment, useFeatureFlag, and conversion tracking for @54vie/analytics","category":"API Reference"},"sidebar":"apiSidebar","previous":{"title":"Analytics Events","permalink":"/api/analytics/events"},"next":{"title":"Hooks API","permalink":"/api/miniapp-sdk/hooks"}}');var a=t(5178),i=t(8145);const s={title:"Experiments & Feature Flags",description:"A/B testing API, useExperiment, useFeatureFlag, and conversion tracking for @54vie/analytics",category:"API Reference"},o="Experiments & Feature Flags",l={},c=[{value:"Installation",id:"installation",level:2},{value:"TypeScript Interfaces",id:"typescript-interfaces",level:2},{value:"Experiment Types",id:"experiment-types",level:3},{value:"Feature Flag Types",id:"feature-flag-types",level:3},{value:"Hook Return Types",id:"hook-return-types",level:3},{value:"useExperiment Hook",id:"useexperiment-hook",level:2},{value:"Import",id:"import",level:3},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Hook Options",id:"hook-options",level:3},{value:"Advanced Usage",id:"advanced-usage",level:3},{value:"With Variant Payloads",id:"with-variant-payloads",level:3},{value:"useFeatureFlag Hook",id:"usefeatureflag-hook",level:2},{value:"Import",id:"import-1",level:3},{value:"Basic Usage",id:"basic-usage-1",level:3},{value:"Hook Options",id:"hook-options-1",level:3},{value:"Typed Feature Flags",id:"typed-feature-flags",level:3},{value:"With Targeting Attributes",id:"with-targeting-attributes",level:3},{value:"useFeatureFlags Hook (Batch)",id:"usefeatureflags-hook-batch",level:2},{value:"Import",id:"import-2",level:3},{value:"Usage",id:"usage",level:3},{value:"Conversion Tracking",id:"conversion-tracking",level:2},{value:"Basic Conversion Tracking",id:"basic-conversion-tracking",level:3},{value:"Multiple Conversion Points",id:"multiple-conversion-points",level:3},{value:"Revenue Tracking",id:"revenue-tracking",level:3},{value:"useExperiments Hook (Multiple Experiments)",id:"useexperiments-hook-multiple-experiments",level:2},{value:"Import",id:"import-3",level:3},{value:"Usage",id:"usage-1",level:3},{value:"Server-Side Rendering",id:"server-side-rendering",level:2},{value:"Next.js App Router",id:"nextjs-app-router",level:3},{value:"Feature Flags with SSR",id:"feature-flags-with-ssr",level:3},{value:"Testing &amp; Development",id:"testing--development",level:2},{value:"Override Variants in Development",id:"override-variants-in-development",level:3},{value:"URL-Based Overrides",id:"url-based-overrides",level:3},{value:"Mock Experiments in Tests",id:"mock-experiments-in-tests",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Experiment Design",id:"experiment-design",level:3},{value:"Gradual Rollouts",id:"gradual-rollouts",level:3},{value:"Cleanup After Experiments",id:"cleanup-after-experiments",level:3},{value:"Avoiding Flickering",id:"avoiding-flickering",level:3},{value:"Related",id:"related",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"experiments--feature-flags",children:"Experiments & Feature Flags"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"@54vie/analytics"})," package provides a complete experimentation platform including A/B testing, multivariate testing, and feature flags. This guide covers the experiment APIs, feature flags, and conversion tracking."]}),"\n",(0,a.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm install @54vie/analytics\n# or\nyarn add @54vie/analytics\n"})}),"\n",(0,a.jsx)(n.h2,{id:"typescript-interfaces",children:"TypeScript Interfaces"}),"\n",(0,a.jsx)(n.h3,{id:"experiment-types",children:"Experiment Types"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"/**\n * Configuration for an experiment\n */\ninterface Experiment {\n  id: string;\n  name: string;\n  description?: string;\n  status: ExperimentStatus;\n  type: ExperimentType;\n  variants: Variant[];\n  targetingRules?: TargetingRule[];\n  trafficAllocation: number;\n  startDate?: string;\n  endDate?: string;\n  primaryMetric?: string;\n  secondaryMetrics?: string[];\n  createdAt: string;\n  updatedAt: string;\n}\n\nenum ExperimentStatus {\n  DRAFT = 'draft',\n  RUNNING = 'running',\n  PAUSED = 'paused',\n  COMPLETED = 'completed',\n  ARCHIVED = 'archived',\n}\n\nenum ExperimentType {\n  AB_TEST = 'ab_test',\n  MULTIVARIATE = 'multivariate',\n  FEATURE_FLAG = 'feature_flag',\n  ROLLOUT = 'rollout',\n}\n\ninterface Variant {\n  id: string;\n  name: string;\n  description?: string;\n  weight: number;\n  payload?: Record<string, unknown>;\n  isControl?: boolean;\n}\n\ninterface TargetingRule {\n  id: string;\n  attribute: string;\n  operator: TargetingOperator;\n  value: string | number | boolean | string[];\n}\n\nenum TargetingOperator {\n  EQUALS = 'equals',\n  NOT_EQUALS = 'not_equals',\n  CONTAINS = 'contains',\n  NOT_CONTAINS = 'not_contains',\n  STARTS_WITH = 'starts_with',\n  ENDS_WITH = 'ends_with',\n  GREATER_THAN = 'greater_than',\n  LESS_THAN = 'less_than',\n  IN = 'in',\n  NOT_IN = 'not_in',\n  REGEX = 'regex',\n  IS_SET = 'is_set',\n  IS_NOT_SET = 'is_not_set',\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"feature-flag-types",children:"Feature Flag Types"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"/**\n * Configuration for a feature flag\n */\ninterface FeatureFlag {\n  id: string;\n  key: string;\n  name: string;\n  description?: string;\n  type: FeatureFlagType;\n  defaultValue: FlagValue;\n  enabled: boolean;\n  targetingRules?: TargetingRule[];\n  rolloutPercentage?: number;\n  variants?: FlagVariant[];\n  createdAt: string;\n  updatedAt: string;\n}\n\nenum FeatureFlagType {\n  BOOLEAN = 'boolean',\n  STRING = 'string',\n  NUMBER = 'number',\n  JSON = 'json',\n}\n\ntype FlagValue = boolean | string | number | Record<string, unknown>;\n\ninterface FlagVariant {\n  value: FlagValue;\n  weight: number;\n  name?: string;\n}\n\ninterface FeatureFlagEvaluation {\n  key: string;\n  value: FlagValue;\n  reason: EvaluationReason;\n  ruleId?: string;\n  variantKey?: string;\n}\n\nenum EvaluationReason {\n  DEFAULT = 'default',\n  TARGETING_MATCH = 'targeting_match',\n  ROLLOUT = 'rollout',\n  OVERRIDE = 'override',\n  ERROR = 'error',\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"hook-return-types",children:"Hook Return Types"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"/**\n * Return type for useExperiment hook\n */\ninterface UseExperimentReturn<T = string> {\n  variant: T;\n  isLoading: boolean;\n  isActive: boolean;\n  error: Error | null;\n  trackConversion: (conversionName?: string, properties?: EventProperties) => void;\n  trackExposure: () => void;\n  metadata: ExperimentMetadata | null;\n}\n\ninterface ExperimentMetadata {\n  experimentId: string;\n  experimentName: string;\n  variantId: string;\n  variantName: string;\n  startedAt: string;\n  endsAt?: string;\n}\n\n/**\n * Return type for useFeatureFlag hook\n */\ninterface UseFeatureFlagReturn<T = boolean> {\n  value: T;\n  isLoading: boolean;\n  isEnabled: boolean;\n  error: Error | null;\n  evaluation: FeatureFlagEvaluation | null;\n}\n\n/**\n * Return type for useFeatureFlags hook (batch)\n */\ninterface UseFeatureFlagsReturn {\n  flags: Record<string, FlagValue>;\n  isLoading: boolean;\n  error: Error | null;\n  getFlag: <T = boolean>(key: string, defaultValue?: T) => T;\n  isEnabled: (key: string) => boolean;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"useexperiment-hook",children:"useExperiment Hook"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"useExperiment"})," hook provides access to A/B test variants and handles experiment tracking."]}),"\n",(0,a.jsx)(n.h3,{id:"import",children:"Import"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { useExperiment } from '@54vie/analytics';\n"})}),"\n",(0,a.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useExperiment } from '@54vie/analytics';\n\nfunction PricingPage() {\n  const { variant, isLoading, trackConversion } = useExperiment<'control' | 'new_layout'>(\n    'pricing_page_experiment',\n    { defaultVariant: 'control' }\n  );\n\n  if (isLoading) {\n    return <LoadingSpinner />;\n  }\n\n  const handlePurchase = (planId: string) => {\n    trackConversion('purchase', { planId });\n  };\n\n  if (variant === 'new_layout') {\n    return <NewPricingLayout onPurchase={handlePurchase} />;\n  }\n\n  return <ControlPricingLayout onPurchase={handlePurchase} />;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"hook-options",children:"Hook Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface UseExperimentOptions<T = string> {\n  /**\n   * Default variant if experiment not found or user not in experiment\n   */\n  defaultVariant?: T;\n\n  /**\n   * Automatically track exposure when variant is accessed\n   * @default true\n   */\n  autoTrackExposure?: boolean;\n\n  /**\n   * Skip this experiment (user always gets default variant)\n   */\n  skip?: boolean;\n\n  /**\n   * Custom attributes for targeting\n   */\n  attributes?: Record<string, unknown>;\n\n  /**\n   * Override the variant for testing purposes\n   */\n  overrideVariant?: T;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useExperiment } from '@54vie/analytics';\n\ntype CheckoutVariant = 'single_page' | 'multi_step' | 'express';\n\nfunction CheckoutPage({ user }) {\n  const {\n    variant,\n    isLoading,\n    isActive,\n    trackConversion,\n    trackExposure,\n    metadata,\n    error,\n  } = useExperiment<CheckoutVariant>('checkout_flow_experiment', {\n    defaultVariant: 'multi_step',\n    autoTrackExposure: false, // Manual exposure tracking\n    skip: user.isEmployee, // Skip for employees\n    attributes: {\n      userTier: user.tier,\n      country: user.country,\n      deviceType: getDeviceType(),\n    },\n  });\n\n  // Manual exposure tracking when component becomes visible\n  useEffect(() => {\n    if (!isLoading && isActive) {\n      trackExposure();\n    }\n  }, [isLoading, isActive]);\n\n  // Track multiple conversion events\n  const handleCheckoutStart = () => {\n    trackConversion('checkout_started');\n  };\n\n  const handleStepComplete = (step: number) => {\n    trackConversion('step_completed', { step });\n  };\n\n  const handlePurchase = (order: Order) => {\n    trackConversion('purchase', {\n      orderId: order.id,\n      revenue: order.total,\n      currency: order.currency,\n    });\n  };\n\n  if (error) {\n    console.error('Experiment error:', error);\n    // Fall back to default experience\n  }\n\n  const checkoutComponents: Record<CheckoutVariant, React.FC> = {\n    single_page: SinglePageCheckout,\n    multi_step: MultiStepCheckout,\n    express: ExpressCheckout,\n  };\n\n  const CheckoutComponent = checkoutComponents[variant];\n\n  return (\n    <CheckoutComponent\n      onStart={handleCheckoutStart}\n      onStepComplete={handleStepComplete}\n      onPurchase={handlePurchase}\n    />\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"with-variant-payloads",children:"With Variant Payloads"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useExperiment } from '@54vie/analytics';\n\ninterface ButtonVariantPayload {\n  color: string;\n  text: string;\n  size: 'small' | 'medium' | 'large';\n}\n\nfunction CTAButton() {\n  const { variant, metadata } = useExperiment<'control' | 'variant_a' | 'variant_b'>(\n    'cta_button_test'\n  );\n\n  // Access variant payload from experiment configuration\n  const payload = metadata?.payload as ButtonVariantPayload | undefined;\n\n  return (\n    <button\n      style={{ backgroundColor: payload?.color ?? 'blue' }}\n      className={`btn-${payload?.size ?? 'medium'}`}\n    >\n      {payload?.text ?? 'Sign Up'}\n    </button>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"usefeatureflag-hook",children:"useFeatureFlag Hook"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"useFeatureFlag"})," hook provides access to individual feature flags."]}),"\n",(0,a.jsx)(n.h3,{id:"import-1",children:"Import"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { useFeatureFlag } from '@54vie/analytics';\n"})}),"\n",(0,a.jsx)(n.h3,{id:"basic-usage-1",children:"Basic Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useFeatureFlag } from '@54vie/analytics';\n\nfunction Dashboard() {\n  const { value: showNewWidget, isLoading } = useFeatureFlag('new_dashboard_widget');\n\n  if (isLoading) {\n    return <LoadingSpinner />;\n  }\n\n  return (\n    <div>\n      <ExistingWidgets />\n      {showNewWidget && <NewWidget />}\n    </div>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"hook-options-1",children:"Hook Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface UseFeatureFlagOptions<T = boolean> {\n  /**\n   * Default value if flag not found or evaluation fails\n   */\n  defaultValue?: T;\n\n  /**\n   * Custom attributes for targeting\n   */\n  attributes?: Record<string, unknown>;\n\n  /**\n   * Track flag evaluation as an event\n   * @default false\n   */\n  trackEvaluation?: boolean;\n\n  /**\n   * Override the flag value for testing\n   */\n  overrideValue?: T;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"typed-feature-flags",children:"Typed Feature Flags"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useFeatureFlag } from '@54vie/analytics';\n\n// Boolean flag\nfunction NewFeatureComponent() {\n  const { value: isEnabled } = useFeatureFlag<boolean>('new_feature_enabled', {\n    defaultValue: false,\n  });\n\n  if (!isEnabled) return null;\n  return <NewFeature />;\n}\n\n// String flag\nfunction ThemeComponent() {\n  const { value: theme } = useFeatureFlag<'light' | 'dark' | 'system'>('default_theme', {\n    defaultValue: 'system',\n  });\n\n  return <ThemeProvider theme={theme}>{/* ... */}</ThemeProvider>;\n}\n\n// Number flag\nfunction RateLimitedComponent() {\n  const { value: maxRequests } = useFeatureFlag<number>('api_rate_limit', {\n    defaultValue: 100,\n  });\n\n  return <RateLimiter maxRequests={maxRequests}>{/* ... */}</RateLimiter>;\n}\n\n// JSON flag\ninterface FeatureConfig {\n  maxItems: number;\n  showBanner: boolean;\n  bannerText: string;\n}\n\nfunction ConfigurableFeature() {\n  const { value: config } = useFeatureFlag<FeatureConfig>('feature_config', {\n    defaultValue: {\n      maxItems: 10,\n      showBanner: false,\n      bannerText: '',\n    },\n  });\n\n  return (\n    <div>\n      {config.showBanner && <Banner text={config.bannerText} />}\n      <ItemList maxItems={config.maxItems} />\n    </div>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"with-targeting-attributes",children:"With Targeting Attributes"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useFeatureFlag } from '@54vie/analytics';\n\nfunction PremiumFeature({ user }) {\n  const { value: hasAccess, evaluation } = useFeatureFlag('premium_feature', {\n    defaultValue: false,\n    attributes: {\n      userId: user.id,\n      plan: user.subscription.plan,\n      country: user.country,\n      accountAge: calculateAccountAge(user.createdAt),\n    },\n    trackEvaluation: true,\n  });\n\n  // Log evaluation reason for debugging\n  useEffect(() => {\n    if (evaluation) {\n      console.log(`Flag evaluated: ${evaluation.reason}`, evaluation);\n    }\n  }, [evaluation]);\n\n  if (!hasAccess) {\n    return <UpgradePrompt />;\n  }\n\n  return <PremiumFeatureContent />;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"usefeatureflags-hook-batch",children:"useFeatureFlags Hook (Batch)"}),"\n",(0,a.jsx)(n.p,{children:"For accessing multiple feature flags efficiently."}),"\n",(0,a.jsx)(n.h3,{id:"import-2",children:"Import"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { useFeatureFlags } from '@54vie/analytics';\n"})}),"\n",(0,a.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useFeatureFlags } from '@54vie/analytics';\n\nfunction App() {\n  const { flags, isLoading, getFlag, isEnabled } = useFeatureFlags([\n    'new_navigation',\n    'dark_mode',\n    'beta_features',\n    'api_v2',\n  ]);\n\n  if (isLoading) {\n    return <LoadingSpinner />;\n  }\n\n  return (\n    <div>\n      {isEnabled('new_navigation') ? <NewNavigation /> : <LegacyNavigation />}\n\n      <ThemeProvider darkMode={getFlag('dark_mode', false)}>\n        <MainContent />\n      </ThemeProvider>\n\n      {isEnabled('beta_features') && <BetaFeatures />}\n    </div>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"conversion-tracking",children:"Conversion Tracking"}),"\n",(0,a.jsx)(n.h3,{id:"basic-conversion-tracking",children:"Basic Conversion Tracking"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useExperiment } from '@54vie/analytics';\n\nfunction SignupForm() {\n  const { variant, trackConversion } = useExperiment('signup_flow');\n\n  const handleSignup = async (formData: FormData) => {\n    const user = await createUser(formData);\n\n    // Track primary conversion\n    trackConversion('signup_completed', {\n      userId: user.id,\n      signupMethod: formData.method,\n    });\n  };\n\n  return <form onSubmit={handleSignup}>{/* form fields */}</form>;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"multiple-conversion-points",children:"Multiple Conversion Points"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useExperiment } from '@54vie/analytics';\n\nfunction OnboardingFlow() {\n  const { trackConversion } = useExperiment('onboarding_experiment');\n\n  // Track funnel progression\n  const trackStep = (step: number, data?: Record<string, unknown>) => {\n    trackConversion(`onboarding_step_${step}`, data);\n  };\n\n  // Track completion\n  const trackComplete = () => {\n    trackConversion('onboarding_completed', {\n      totalTime: calculateElapsedTime(),\n    });\n  };\n\n  // Track drop-off\n  const trackDropoff = (step: number, reason?: string) => {\n    trackConversion('onboarding_dropoff', {\n      step,\n      reason,\n    });\n  };\n\n  return <OnboardingUI onStep={trackStep} onComplete={trackComplete} />;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"revenue-tracking",children:"Revenue Tracking"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useExperiment } from '@54vie/analytics';\n\nfunction CheckoutComplete({ order }) {\n  const { trackConversion } = useExperiment('checkout_experiment');\n\n  useEffect(() => {\n    // Track purchase with revenue\n    trackConversion('purchase', {\n      revenue: order.total,\n      currency: order.currency,\n      orderId: order.id,\n      itemCount: order.items.length,\n    });\n\n    // Track per-item revenue\n    order.items.forEach((item) => {\n      trackConversion('item_purchased', {\n        itemId: item.id,\n        itemName: item.name,\n        price: item.price,\n        quantity: item.quantity,\n        category: item.category,\n      });\n    });\n  }, [order.id]);\n\n  return <OrderConfirmation order={order} />;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"useexperiments-hook-multiple-experiments",children:"useExperiments Hook (Multiple Experiments)"}),"\n",(0,a.jsx)(n.p,{children:"For components participating in multiple experiments."}),"\n",(0,a.jsx)(n.h3,{id:"import-3",children:"Import"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { useExperiments } from '@54vie/analytics';\n"})}),"\n",(0,a.jsx)(n.h3,{id:"usage-1",children:"Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useExperiments } from '@54vie/analytics';\n\nfunction ProductPage({ product }) {\n  const experiments = useExperiments({\n    layout: 'product_page_layout',\n    pricing: 'pricing_display_test',\n    recommendations: 'recommendation_algorithm',\n  });\n\n  if (experiments.isLoading) {\n    return <LoadingSpinner />;\n  }\n\n  const layoutVariant = experiments.getVariant('layout', 'control');\n  const pricingVariant = experiments.getVariant('pricing', 'standard');\n  const recsVariant = experiments.getVariant('recommendations', 'collaborative');\n\n  const handlePurchase = () => {\n    // Track conversion for all active experiments\n    experiments.trackConversion('purchase', {\n      productId: product.id,\n      price: product.price,\n    });\n  };\n\n  return (\n    <ProductLayout variant={layoutVariant}>\n      <ProductDetails product={product} />\n      <PriceDisplay product={product} variant={pricingVariant} />\n      <Recommendations variant={recsVariant} />\n      <BuyButton onClick={handlePurchase} />\n    </ProductLayout>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"server-side-rendering",children:"Server-Side Rendering"}),"\n",(0,a.jsx)(n.h3,{id:"nextjs-app-router",children:"Next.js App Router"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// app/page.tsx\nimport { ExperimentProvider, getExperimentVariant } from '@54vie/analytics/server';\n\nexport default async function Page() {\n  // Fetch variant on server\n  const variant = await getExperimentVariant('homepage_experiment', {\n    defaultVariant: 'control',\n  });\n\n  return (\n    <ExperimentProvider\n      experimentKey=\"homepage_experiment\"\n      initialVariant={variant}\n    >\n      <HomePageContent />\n    </ExperimentProvider>\n  );\n}\n\n// Client component\n'use client';\nimport { useExperiment } from '@54vie/analytics';\n\nfunction HomePageContent() {\n  const { variant, trackConversion } = useExperiment('homepage_experiment');\n\n  // variant is hydrated from server, no loading state\n  return variant === 'new_hero' ? <NewHero /> : <ControlHero />;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"feature-flags-with-ssr",children:"Feature Flags with SSR"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// app/layout.tsx\nimport { FeatureFlagProvider, evaluateFlags } from '@54vie/analytics/server';\n\nexport default async function RootLayout({ children }) {\n  const flags = await evaluateFlags(['new_navigation', 'dark_mode']);\n\n  return (\n    <html>\n      <body>\n        <FeatureFlagProvider initialFlags={flags}>\n          {children}\n        </FeatureFlagProvider>\n      </body>\n    </html>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"testing--development",children:"Testing & Development"}),"\n",(0,a.jsx)(n.h3,{id:"override-variants-in-development",children:"Override Variants in Development"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { AnalyticsProvider } from '@54vie/analytics';\n\nfunction App() {\n  return (\n    <AnalyticsProvider\n      apiKey={process.env.NEXT_PUBLIC_ANALYTICS_KEY!}\n      projectId={process.env.NEXT_PUBLIC_PROJECT_ID!}\n      config={{\n        experiments: {\n          // Force specific variants in development\n          overrides: process.env.NODE_ENV === 'development' ? {\n            'checkout_experiment': 'express',\n            'pricing_test': 'variant_b',\n          } : undefined,\n        },\n      }}\n    >\n      <YourApp />\n    </AnalyticsProvider>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"url-based-overrides",children:"URL-Based Overrides"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// Enable via URL: ?experiment_checkout=express\nimport { useExperiment } from '@54vie/analytics';\n\nfunction Checkout() {\n  const searchParams = new URLSearchParams(window.location.search);\n  const urlOverride = searchParams.get('experiment_checkout');\n\n  const { variant } = useExperiment('checkout_experiment', {\n    overrideVariant: urlOverride as any,\n  });\n\n  // ...\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"mock-experiments-in-tests",children:"Mock Experiments in Tests"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { render } from '@testing-library/react';\nimport { MockAnalyticsProvider } from '@54vie/analytics/testing';\n\ndescribe('PricingPage', () => {\n  it('renders control variant', () => {\n    render(\n      <MockAnalyticsProvider\n        experiments={{\n          pricing_test: { variant: 'control', isActive: true },\n        }}\n      >\n        <PricingPage />\n      </MockAnalyticsProvider>\n    );\n\n    expect(screen.getByText('Standard Pricing')).toBeInTheDocument();\n  });\n\n  it('renders new pricing variant', () => {\n    render(\n      <MockAnalyticsProvider\n        experiments={{\n          pricing_test: { variant: 'new_pricing', isActive: true },\n        }}\n      >\n        <PricingPage />\n      </MockAnalyticsProvider>\n    );\n\n    expect(screen.getByText('New Pricing Layout')).toBeInTheDocument();\n  });\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"experiment-design",children:"Experiment Design"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// Good - clear, measurable experiment\nconst experiment = {\n  name: 'checkout_simplification',\n  hypothesis: 'Reducing checkout steps will increase conversion rate',\n  primaryMetric: 'checkout_completed',\n  secondaryMetrics: ['cart_abandonment', 'average_order_value'],\n  minimumSampleSize: 10000,\n  duration: '14 days',\n};\n\n// Define clear variants\ntype CheckoutVariant = 'control' | 'simplified' | 'express';\n"})}),"\n",(0,a.jsx)(n.h3,{id:"gradual-rollouts",children:"Gradual Rollouts"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useFeatureFlag } from '@54vie/analytics';\n\nfunction NewFeature() {\n  const { value: rolloutPercentage } = useFeatureFlag<number>('new_feature_rollout', {\n    defaultValue: 0,\n  });\n\n  // Feature is gradually rolled out via dashboard\n  // 0% -> 5% -> 25% -> 50% -> 100%\n\n  if (rolloutPercentage === 0) {\n    return null;\n  }\n\n  return <FeatureContent />;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"cleanup-after-experiments",children:"Cleanup After Experiments"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// Before experiment ends\nfunction ComponentWithExperiment() {\n  const { variant } = useExperiment('button_color_test');\n\n  return variant === 'green' ? <GreenButton /> : <BlueButton />;\n}\n\n// After experiment concludes with 'green' as winner\nfunction ComponentAfterExperiment() {\n  // Remove experiment code, ship winning variant\n  return <GreenButton />;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"avoiding-flickering",children:"Avoiding Flickering"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { useExperiment } from '@54vie/analytics';\n\nfunction HeroSection() {\n  const { variant, isLoading } = useExperiment('hero_test');\n\n  // Show skeleton while loading to prevent layout shift\n  if (isLoading) {\n    return <HeroSkeleton />;\n  }\n\n  return variant === 'video_hero' ? <VideoHero /> : <ImageHero />;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/api/analytics/provider",children:"Provider"})," - AnalyticsProvider setup and configuration"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/api/analytics/hooks",children:"Hooks"})," - useAnalytics, useUserProperties, useExperiment"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/api/analytics/events",children:"Events"})," - StandardEvents and custom event tracking"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8145(e,n,t){t.d(n,{R:()=>s,x:()=>o});var r=t(5410);const a={},i=r.createContext(a);function s(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);