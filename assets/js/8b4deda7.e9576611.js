"use strict";(globalThis.webpackChunk_54vie_cookbooks=globalThis.webpackChunk_54vie_cookbooks||[]).push([[866],{6906(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>r,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"guides/create-mini-app","title":"Create a New Mini-App","description":"Detailed guide to create a new mini-app for 54VIE Super App.","source":"@site/docs/guides/create-mini-app.md","sourceDirName":"guides","slug":"/guides/create-mini-app","permalink":"/guides/create-mini-app","draft":false,"unlisted":false,"editUrl":"https://github.com/54vie/super-app/tree/main/cookbooks/docs/guides/create-mini-app.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Create a New Mini-App"},"sidebar":"mainSidebar","previous":{"title":"@54vie/media","permalink":"/modules/media"},"next":{"title":"Authentication","permalink":"/guides/authentication"}}');var a=i(5178),s=i(8145);const r={sidebar_position:1,title:"Create a New Mini-App"},o="Guide to Creating a New Mini-App",c={},p=[{value:"1. Create project structure",id:"1-create-project-structure",level:2},{value:"Directory structure",id:"directory-structure",level:3},{value:"2. Package.json",id:"2-packagejson",level:2},{value:"3. Module Federation Config",id:"3-module-federation-config",level:2},{value:"4. Manifest.json",id:"4-manifestjson",level:2},{value:"5. App Entry Point",id:"5-app-entry-point",level:2},{value:"6. Using the SDK",id:"6-using-the-sdk",level:2},{value:"7. Storage Usage",id:"7-storage-usage",level:2},{value:"8. Build &amp; Deploy",id:"8-build--deploy",level:2},{value:"Development",id:"development",level:3},{value:"Production Build",id:"production-build",level:3},{value:"Upload to CDN",id:"upload-to-cdn",level:3},{value:"9. Register in Backend",id:"9-register-in-backend",level:2},{value:"Checklist",id:"checklist",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"guide-to-creating-a-new-mini-app",children:"Guide to Creating a New Mini-App"})}),"\n",(0,a.jsx)(n.p,{children:"Detailed guide to create a new mini-app for 54VIE Super App."}),"\n",(0,a.jsx)(n.h2,{id:"1-create-project-structure",children:"1. Create project structure"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir mini-programs/my-miniapp\ncd mini-programs/my-miniapp\n"})}),"\n",(0,a.jsx)(n.h3,{id:"directory-structure",children:"Directory structure"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"my-miniapp/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 App.tsx              # Entry point\n\u2502   \u251c\u2500\u2500 screens/\n\u2502   \u2502   \u251c\u2500\u2500 HomeScreen.tsx\n\u2502   \u2502   \u2514\u2500\u2500 DetailScreen.tsx\n\u2502   \u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2514\u2500\u2500 services/\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u251c\u2500\u2500 rspack.config.mjs        # Module Federation config\n\u2514\u2500\u2500 manifest.json            # Mini-app manifest\n"})}),"\n",(0,a.jsx)(n.h2,{id:"2-packagejson",children:"2. Package.json"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "name": "my-miniapp",\n  "version": "1.0.0",\n  "main": "src/App.tsx",\n  "scripts": {\n    "start": "react-native start --port 9002",\n    "bundle:ios": "rspack build --config rspack.config.mjs --env platform=ios",\n    "bundle:android": "rspack build --config rspack.config.mjs --env platform=android"\n  },\n  "dependencies": {\n    "@54vie/kit": "workspace:*",\n    "@54vie/miniapp-sdk": "workspace:*",\n    "@react-navigation/native": "^7.0.0",\n    "@react-navigation/native-stack": "^7.0.0"\n  },\n  "devDependencies": {\n    "@54vie/core": "workspace:*",\n    "@callstack/repack": "^5.0.0",\n    "@rspack/core": "^1.0.0",\n    "typescript": "^5.0.0"\n  },\n  "peerDependencies": {\n    "react": "*",\n    "react-native": "*"\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"3-module-federation-config",children:"3. Module Federation Config"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"// rspack.config.mjs\nimport { createRequire } from 'node:module';\nimport path from 'node:path';\nimport * as Repack from '@callstack/repack';\n\nconst require = createRequire(import.meta.url);\nconst STANDALONE = process.env.STANDALONE === 'true';\n\nexport default (env) => {\n  const { platform } = env;\n\n  return {\n    context: __dirname,\n    entry: './src/index.js',\n    output: {\n      path: path.join(__dirname, 'build', platform),\n      filename: 'index.bundle',\n      publicPath: Repack.getPublicPath({ platform }),\n    },\n    plugins: [\n      new Repack.RepackPlugin(),\n      new Repack.plugins.ModuleFederationPluginV2({\n        name: 'my_miniapp',\n        filename: 'my_miniapp.container.js',\n        exposes: {\n          './App': './src/App.tsx',\n        },\n        shared: {\n          react: { singleton: true, eager: STANDALONE },\n          'react-native': { singleton: true, eager: STANDALONE },\n          '@react-navigation/native': { singleton: true },\n          '@react-navigation/native-stack': { singleton: true },\n          '@54vie/kit': { singleton: true },\n          '@54vie/miniapp-sdk': { singleton: true },\n        },\n      }),\n    ],\n  };\n};\n"})}),"\n",(0,a.jsx)(n.h2,{id:"4-manifestjson",children:"4. Manifest.json"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "appId": "com.54vie.my-miniapp",\n  "name": "My Mini App",\n  "version": "1.0.0",\n  "description": "Description of my mini app",\n  "icon": "https://cdn.54vie.vn/icons/my-miniapp.png",\n  "permissions": [\n    "storage",\n    "analytics"\n  ],\n  "minHostVersion": "1.0.0"\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"5-app-entry-point",children:"5. App Entry Point"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// src/App.tsx\nimport React from 'react';\nimport { NavigationContainer } from '@react-navigation/native';\nimport { createNativeStackNavigator } from '@react-navigation/native-stack';\nimport { ToastProvider } from '@54vie/kit';\nimport HomeScreen from './screens/HomeScreen';\nimport DetailScreen from './screens/DetailScreen';\n\nconst Stack = createNativeStackNavigator();\n\nexport default function App() {\n  return (\n    <ToastProvider>\n      <NavigationContainer independent>\n        <Stack.Navigator>\n          <Stack.Screen name=\"Home\" component={HomeScreen} />\n          <Stack.Screen name=\"Detail\" component={DetailScreen} />\n        </Stack.Navigator>\n      </NavigationContainer>\n    </ToastProvider>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.admonition,{title:"NavigationContainer",type:"warning",children:(0,a.jsxs)(n.p,{children:["Always use the ",(0,a.jsx)(n.code,{children:"independent"})," prop for NavigationContainer in mini-apps to avoid conflicts with host navigation."]})}),"\n",(0,a.jsx)(n.h2,{id:"6-using-the-sdk",children:"6. Using the SDK"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// src/screens/HomeScreen.tsx\nimport React, { useEffect } from 'react';\nimport { View, FlatList } from 'react-native';\nimport { Button, Card, Text, Loading } from '@54vie/kit';\nimport {\n  useHostAuth,\n  useHostDevice,\n  storage,\n  analytics,\n  api,\n} from '@54vie/miniapp-sdk';\n\nexport default function HomeScreen({ navigation }) {\n  const { user, isAuthenticated, requestLogin } = useHostAuth();\n  const { deviceInfo } = useHostDevice();\n\n  // Track screen view\n  useEffect(() => {\n    analytics.screen('HomeScreen');\n  }, []);\n\n  // Fetch data from API\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const data = await api.get('/my-miniapp/items');\n        setItems(data);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchData();\n  }, []);\n\n  // Handle not authenticated\n  if (!isAuthenticated) {\n    return (\n      <View style={{ flex: 1, justifyContent: 'center', padding: 20 }}>\n        <Text>Please login to continue</Text>\n        <Button onPress={requestLogin}>Login</Button>\n      </View>\n    );\n  }\n\n  if (loading) return <Loading />;\n\n  return (\n    <View style={{ flex: 1 }}>\n      <Text>Welcome, {user.name}!</Text>\n\n      <FlatList\n        data={items}\n        renderItem={({ item }) => (\n          <Card onPress={() => navigation.navigate('Detail', { id: item.id })}>\n            <Text>{item.title}</Text>\n          </Card>\n        )}\n      />\n    </View>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"7-storage-usage",children:"7. Storage Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"import { storage } from '@54vie/miniapp-sdk';\n\n// Save user preferences\nawait storage.set('preferences', {\n  theme: 'dark',\n  notifications: true,\n});\n\n// Load preferences\nconst prefs = await storage.get('preferences');\n"})}),"\n",(0,a.jsx)(n.h2,{id:"8-build--deploy",children:"8. Build & Deploy"}),"\n",(0,a.jsx)(n.h3,{id:"development",children:"Development"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Start dev server\npnpm start\n"})}),"\n",(0,a.jsx)(n.h3,{id:"production-build",children:"Production Build"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Build for iOS\npnpm bundle:ios\n\n# Build for Android\npnpm bundle:android\n"})}),"\n",(0,a.jsx)(n.h3,{id:"upload-to-cdn",children:"Upload to CDN"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Zip the build folder\ncd build/ios && zip -r ../../my-miniapp-ios.zip . && cd ../..\ncd build/android && zip -r ../../my-miniapp-android.zip . && cd ../..\n\n# Upload to R2/S3\naws s3 cp my-miniapp-ios.zip s3://54vie-cdn/mini-apps/my-miniapp/1.0.0/ios.zip\naws s3 cp my-miniapp-android.zip s3://54vie-cdn/mini-apps/my-miniapp/1.0.0/android.zip\n"})}),"\n",(0,a.jsx)(n.h2,{id:"9-register-in-backend",children:"9. Register in Backend"}),"\n",(0,a.jsx)(n.p,{children:"Call the API to register the mini-app:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://api.54vie.vn/v1/admin/mini-programs \\\n  -H "Authorization: Bearer $ADMIN_TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "appId": "com.54vie.my-miniapp",\n    "name": "My Mini App",\n    "version": "1.0.0",\n    "manifestUrl": "https://cdn.54vie.vn/mini-apps/my-miniapp/1.0.0/mf-manifest.json",\n    "bundleZipUrl": "https://cdn.54vie.vn/mini-apps/my-miniapp/1.0.0/${platform}.zip",\n    "permissions": ["storage", "analytics"],\n    "minHostVersion": "1.0.0"\n  }\'\n'})}),"\n",(0,a.jsx)(n.h2,{id:"checklist",children:"Checklist"}),"\n",(0,a.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create project structure"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configure package.json"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configure rspack.config.mjs"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create manifest.json"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement App.tsx with NavigationContainer"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use @54vie/kit for UI"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use @54vie/miniapp-sdk for host services"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Track analytics events"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test on iOS and Android"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Build and upload bundles"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Register in backend"]}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8145(e,n,i){i.d(n,{R:()=>r,x:()=>o});var t=i(5410);const a={},s=t.createContext(a);function r(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);