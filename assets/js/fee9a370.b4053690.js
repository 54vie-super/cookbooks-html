"use strict";(globalThis.webpackChunk_54vie_cookbooks=globalThis.webpackChunk_54vie_cookbooks||[]).push([[231],{3667(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"api/api-client/client","title":"ApiClient","description":"Core HTTP client for making API requests","source":"@site/docs/api/api-client/client.md","sourceDirName":"api/api-client","slug":"/api/api-client/client","permalink":"/api/api-client/client","draft":false,"unlisted":false,"editUrl":"https://github.com/54vie/super-app/tree/main/cookbooks/docs/api/api-client/client.md","tags":[],"version":"current","frontMatter":{"title":"ApiClient","description":"Core HTTP client for making API requests","package":"@54vie/api","category":"API Client"},"sidebar":"apiSidebar","previous":{"title":"Theme","permalink":"/api/kit/theme"},"next":{"title":"React Hooks","permalink":"/api/api-client/hooks"}}');var s=t(5178),i=t(8145);const o={title:"ApiClient",description:"Core HTTP client for making API requests",package:"@54vie/api",category:"API Client"},a="ApiClient",c={},l=[{value:"Installation",id:"installation",level:2},{value:"TypeScript Interfaces",id:"typescript-interfaces",level:2},{value:"Creating an ApiClient Instance",id:"creating-an-apiclient-instance",level:2},{value:"HTTP Methods",id:"http-methods",level:2},{value:"GET Request",id:"get-request",level:3},{value:"POST Request",id:"post-request",level:3},{value:"PUT Request",id:"put-request",level:3},{value:"PATCH Request",id:"patch-request",level:3},{value:"DELETE Request",id:"delete-request",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Full Configuration Example",id:"full-configuration-example",level:3},{value:"Authentication Headers",id:"authentication-headers",level:2},{value:"Bearer Token Authentication",id:"bearer-token-authentication",level:3},{value:"Dynamic Token",id:"dynamic-token",level:3},{value:"API Key Authentication",id:"api-key-authentication",level:3},{value:"Basic Authentication",id:"basic-authentication",level:3},{value:"Custom Authentication",id:"custom-authentication",level:3},{value:"Interceptors",id:"interceptors",level:2},{value:"Request Interceptors",id:"request-interceptors",level:3},{value:"Response Interceptors",id:"response-interceptors",level:3},{value:"Logging Interceptor Example",id:"logging-interceptor-example",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Request Cancellation",id:"request-cancellation",level:2},{value:"Creating Multiple Instances",id:"creating-multiple-instances",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Related",id:"related",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"apiclient",children:"ApiClient"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"ApiClient"})," class provides a type-safe HTTP client for making API requests with built-in support for authentication, interceptors, and error handling."]}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install @54vie/api\n# or\nyarn add @54vie/api\n# or\npnpm add @54vie/api\n"})}),"\n",(0,s.jsx)(n.h2,{id:"typescript-interfaces",children:"TypeScript Interfaces"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface ApiClientConfig {\n  baseURL: string;\n  timeout?: number;\n  headers?: Record<string, string>;\n  withCredentials?: boolean;\n  retryConfig?: RetryConfig;\n  authConfig?: AuthConfig;\n}\n\ninterface RetryConfig {\n  maxRetries?: number;\n  retryDelay?: number;\n  retryCondition?: (error: ApiError) => boolean;\n}\n\ninterface AuthConfig {\n  type: 'bearer' | 'basic' | 'api-key' | 'custom';\n  token?: string | (() => string | Promise<string>);\n  headerName?: string;\n  refreshToken?: () => Promise<string>;\n  onTokenRefresh?: (newToken: string) => void;\n}\n\ninterface RequestConfig<T = unknown> {\n  url: string;\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  data?: T;\n  params?: Record<string, string | number | boolean>;\n  headers?: Record<string, string>;\n  timeout?: number;\n  signal?: AbortSignal;\n  responseType?: 'json' | 'text' | 'blob' | 'arraybuffer';\n}\n\ninterface ApiResponse<T> {\n  data: T;\n  status: number;\n  statusText: string;\n  headers: Record<string, string>;\n}\n\ninterface ApiError {\n  message: string;\n  status?: number;\n  code?: string;\n  data?: unknown;\n  originalError?: Error;\n}\n\ninterface Interceptor<T> {\n  onFulfilled?: (value: T) => T | Promise<T>;\n  onRejected?: (error: ApiError) => ApiError | Promise<ApiError>;\n}\n\ntype RequestInterceptor = Interceptor<RequestConfig>;\ntype ResponseInterceptor = Interceptor<ApiResponse<unknown>>;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"creating-an-apiclient-instance",children:"Creating an ApiClient Instance"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { ApiClient } from '@54vie/api';\n\nconst client = new ApiClient({\n  baseURL: 'https://api.54vie.com/v1',\n  timeout: 30000,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  withCredentials: true,\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"http-methods",children:"HTTP Methods"}),"\n",(0,s.jsx)(n.h3,{id:"get-request",children:"GET Request"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Simple GET request\nconst response = await client.get<User>('/users/123');\nconsole.log(response.data);\n\n// GET with query parameters\nconst users = await client.get<User[]>('/users', {\n  params: {\n    page: 1,\n    limit: 10,\n    status: 'active',\n  },\n});\n\n// GET with custom headers\nconst profile = await client.get<Profile>('/profile', {\n  headers: {\n    'X-Custom-Header': 'value',\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"post-request",children:"POST Request"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Create a new resource\nconst newUser = await client.post<User>('/users', {\n  data: {\n    name: 'John Doe',\n    email: 'john@example.com',\n  },\n});\n\n// POST with form data\nconst formData = new FormData();\nformData.append('file', file);\nformData.append('name', 'document.pdf');\n\nconst upload = await client.post<UploadResponse>('/files/upload', {\n  data: formData,\n  headers: {\n    'Content-Type': 'multipart/form-data',\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"put-request",children:"PUT Request"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Full resource update\nconst updatedUser = await client.put<User>('/users/123', {\n  data: {\n    name: 'John Updated',\n    email: 'john.updated@example.com',\n    role: 'admin',\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"patch-request",children:"PATCH Request"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Partial resource update\nconst patchedUser = await client.patch<User>('/users/123', {\n  data: {\n    name: 'John Patched',\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"delete-request",children:"DELETE Request"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Delete a resource\nawait client.delete('/users/123');\n\n// Delete with confirmation body\nawait client.delete('/users/123', {\n  data: {\n    confirm: true,\n    reason: 'User requested account deletion',\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,s.jsx)(n.h3,{id:"full-configuration-example",children:"Full Configuration Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const client = new ApiClient({\n  // Base URL for all requests\n  baseURL: 'https://api.54vie.com/v1',\n\n  // Request timeout in milliseconds\n  timeout: 30000,\n\n  // Default headers for all requests\n  headers: {\n    'Content-Type': 'application/json',\n    'X-App-Version': '1.0.0',\n  },\n\n  // Include credentials in cross-origin requests\n  withCredentials: true,\n\n  // Retry configuration\n  retryConfig: {\n    maxRetries: 3,\n    retryDelay: 1000,\n    retryCondition: (error) => {\n      // Retry on network errors or 5xx status codes\n      return !error.status || error.status >= 500;\n    },\n  },\n\n  // Authentication configuration\n  authConfig: {\n    type: 'bearer',\n    token: () => localStorage.getItem('accessToken') || '',\n    refreshToken: async () => {\n      const response = await fetch('/auth/refresh', {\n        method: 'POST',\n        credentials: 'include',\n      });\n      const data = await response.json();\n      return data.accessToken;\n    },\n    onTokenRefresh: (newToken) => {\n      localStorage.setItem('accessToken', newToken);\n    },\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"authentication-headers",children:"Authentication Headers"}),"\n",(0,s.jsx)(n.h3,{id:"bearer-token-authentication",children:"Bearer Token Authentication"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const client = new ApiClient({\n  baseURL: 'https://api.54vie.com/v1',\n  authConfig: {\n    type: 'bearer',\n    token: 'your-jwt-token',\n  },\n});\n\n// Results in header: Authorization: Bearer your-jwt-token\n"})}),"\n",(0,s.jsx)(n.h3,{id:"dynamic-token",children:"Dynamic Token"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const client = new ApiClient({\n  baseURL: 'https://api.54vie.com/v1',\n  authConfig: {\n    type: 'bearer',\n    token: () => {\n      // Dynamically get token from storage or state\n      return localStorage.getItem('accessToken') || '';\n    },\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"api-key-authentication",children:"API Key Authentication"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const client = new ApiClient({\n  baseURL: 'https://api.54vie.com/v1',\n  authConfig: {\n    type: 'api-key',\n    token: 'your-api-key',\n    headerName: 'X-API-Key', // Custom header name\n  },\n});\n\n// Results in header: X-API-Key: your-api-key\n"})}),"\n",(0,s.jsx)(n.h3,{id:"basic-authentication",children:"Basic Authentication"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const client = new ApiClient({\n  baseURL: 'https://api.54vie.com/v1',\n  authConfig: {\n    type: 'basic',\n    token: btoa('username:password'),\n  },\n});\n\n// Results in header: Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=\n"})}),"\n",(0,s.jsx)(n.h3,{id:"custom-authentication",children:"Custom Authentication"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const client = new ApiClient({\n  baseURL: 'https://api.54vie.com/v1',\n  authConfig: {\n    type: 'custom',\n    token: async () => {\n      // Custom logic to get auth token\n      const session = await getSession();\n      return `Custom ${session.token}`;\n    },\n    headerName: 'Authorization',\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"interceptors",children:"Interceptors"}),"\n",(0,s.jsx)(n.h3,{id:"request-interceptors",children:"Request Interceptors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Add request interceptor\nconst requestInterceptorId = client.interceptors.request.use({\n  onFulfilled: (config) => {\n    // Add timestamp to all requests\n    config.headers = {\n      ...config.headers,\n      'X-Request-Time': Date.now().toString(),\n    };\n    console.log(`[Request] ${config.method} ${config.url}`);\n    return config;\n  },\n  onRejected: (error) => {\n    console.error('[Request Error]', error);\n    return Promise.reject(error);\n  },\n});\n\n// Remove request interceptor\nclient.interceptors.request.eject(requestInterceptorId);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"response-interceptors",children:"Response Interceptors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Add response interceptor\nconst responseInterceptorId = client.interceptors.response.use({\n  onFulfilled: (response) => {\n    // Log successful responses\n    console.log(`[Response] ${response.status} ${response.statusText}`);\n\n    // Transform response data if needed\n    return {\n      ...response,\n      data: {\n        ...response.data,\n        receivedAt: new Date().toISOString(),\n      },\n    };\n  },\n  onRejected: async (error) => {\n    // Handle 401 errors globally\n    if (error.status === 401) {\n      // Attempt token refresh\n      try {\n        await client.refreshAuth();\n        // Retry the original request\n        return client.request(error.config);\n      } catch (refreshError) {\n        // Redirect to login\n        window.location.href = '/login';\n      }\n    }\n\n    return Promise.reject(error);\n  },\n});\n\n// Remove response interceptor\nclient.interceptors.response.eject(responseInterceptorId);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"logging-interceptor-example",children:"Logging Interceptor Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Create a comprehensive logging interceptor\nclient.interceptors.request.use({\n  onFulfilled: (config) => {\n    const requestId = crypto.randomUUID();\n    config.headers = {\n      ...config.headers,\n      'X-Request-ID': requestId,\n    };\n\n    console.group(`API Request [${requestId}]`);\n    console.log('Method:', config.method);\n    console.log('URL:', config.url);\n    console.log('Params:', config.params);\n    console.log('Data:', config.data);\n    console.groupEnd();\n\n    return config;\n  },\n});\n\nclient.interceptors.response.use({\n  onFulfilled: (response) => {\n    const requestId = response.headers['x-request-id'];\n\n    console.group(`API Response [${requestId}]`);\n    console.log('Status:', response.status);\n    console.log('Data:', response.data);\n    console.groupEnd();\n\n    return response;\n  },\n  onRejected: (error) => {\n    console.group('API Error');\n    console.error('Status:', error.status);\n    console.error('Message:', error.message);\n    console.error('Data:', error.data);\n    console.groupEnd();\n\n    return Promise.reject(error);\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { ApiClient, ApiError, isApiError } from '@54vie/api';\n\ntry {\n  const response = await client.get<User>('/users/123');\n  console.log(response.data);\n} catch (error) {\n  if (isApiError(error)) {\n    switch (error.status) {\n      case 400:\n        console.error('Bad Request:', error.data);\n        break;\n      case 401:\n        console.error('Unauthorized');\n        // Redirect to login\n        break;\n      case 403:\n        console.error('Forbidden');\n        break;\n      case 404:\n        console.error('Not Found');\n        break;\n      case 429:\n        console.error('Rate Limited');\n        break;\n      case 500:\n        console.error('Server Error');\n        break;\n      default:\n        console.error('Unknown Error:', error.message);\n    }\n  } else {\n    console.error('Network Error:', error);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"request-cancellation",children:"Request Cancellation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Using AbortController\nconst controller = new AbortController();\n\n// Make request with signal\nconst responsePromise = client.get<User[]>('/users', {\n  signal: controller.signal,\n});\n\n// Cancel the request\ncontroller.abort();\n\n// Handle cancellation\ntry {\n  const response = await responsePromise;\n} catch (error) {\n  if (error.name === 'AbortError') {\n    console.log('Request was cancelled');\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"creating-multiple-instances",children:"Creating Multiple Instances"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Main API client\nconst mainClient = new ApiClient({\n  baseURL: 'https://api.54vie.com/v1',\n  authConfig: {\n    type: 'bearer',\n    token: () => getAccessToken(),\n  },\n});\n\n// Admin API client with different configuration\nconst adminClient = new ApiClient({\n  baseURL: 'https://admin.54vie.com/api',\n  authConfig: {\n    type: 'api-key',\n    token: process.env.ADMIN_API_KEY,\n    headerName: 'X-Admin-Key',\n  },\n});\n\n// Third-party API client\nconst externalClient = new ApiClient({\n  baseURL: 'https://external-api.com',\n  timeout: 60000,\n  retryConfig: {\n    maxRetries: 5,\n    retryDelay: 2000,\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Create a singleton instance"})," for your API client to ensure consistent configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use interceptors"})," for cross-cutting concerns like logging, auth, and error handling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type your responses"})," using generics for type safety"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Handle errors gracefully"})," with appropriate user feedback"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use request cancellation"})," for cleanup in components that unmount"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configure retries"})," for transient failures"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/api/api-client/hooks",children:"React Hooks"})," - useQuery, useMutation hooks for React"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/api/api-client/websocket",children:"WebSocket Client"})," - Real-time communication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/api/api-client/cache",children:"Caching"})," - Response caching and offline support"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},8145(e,n,t){t.d(n,{R:()=>o,x:()=>a});var r=t(5410);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);